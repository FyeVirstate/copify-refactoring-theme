{%- assign rating = rating | default: 4.5 -%}
{%- assign uid = uid | default: 'sr' -%}

{%- assign half_steps = rating | times: 2 | round -%}
{%- assign full = half_steps | divided_by: 2 -%}
{%- assign has_half = half_steps | modulo: 2 -%}
{%- assign full_plus_one = full | plus: 1 -%}

<style>
  .sr-stars {
    display: inline-flex;
    gap: 0;
    align-items: center;
    line-height: 0;
  }
  .sr-star {
    display: inline-block;
    width: 13px;
    height: 13px;
  }
  .sr-star svg {
    width: 100%;
    height: 100%;
    display: block;
  }
</style>

<div
  class="sr-stars"
  role="img"
  aria-label="{{ rating }} out of 5">
  {%- for i in (1..5) -%}
    <span class="sr-star" aria-hidden="true">
      {%- if i <= full -%}
        <!-- full star -->
        <svg
          viewBox="0 0 17 17"
          xmlns="http://www.w3.org/2000/svg"
          role="img">
          <path fill="#F6B51E" d="M16.5 6.53838L11.0814 5.90982L8.79708 1.0625L6.51282 5.90982L1.09998 6.53838L5.10178 10.1682L4.0435 15.4062L8.79708 12.7957L13.5565 15.4062L12.4982 10.1682L16.5 6.53838Z" />
        </svg>

      {%- elsif has_half == 1 and i == full_plus_one -%}
        {%- assign clip_id = uid | append: '-half-' | append: forloop.index0 -%}
        <!-- half star -->
        <svg
          class="half_star"
          viewBox="0 0 17 17"
          xmlns="http://www.w3.org/2000/svg"
          role="img"
          aria-hidden="true"
          focusable="false">
          <defs>
            <clipPath id="{{ clip_id }}" clipPathUnits="userSpaceOnUse">
              <rect
                x="0"
                y="0"
                width="8.5"
                height="17" />
            </clipPath>
          </defs>

          <!-- base (empty outline) -->
          <path
            class="half_star_border"
            fill="transparent"
            stroke="rgb(var(--color-primary))"
            stroke-width="1.5"
            d="M16.5 6.53838L11.0814 5.90982L8.79708 1.0625L6.51282 5.90982L1.09998 6.53838L5.10178 10.1682L4.0435 15.4062L8.79708 12.7957L13.5565 15.4062L12.4982 10.1682L16.5 6.53838Z" />

            <!-- clipped filled star on top -->
          <path
            class="half_star_path"
            clip-path="url(#{{ clip_id }})"
            fill="rgb(var(--color-primary))"
            d="M16.5 6.53838L11.0814 5.90982L8.79708 1.0625L6.51282 5.90982L1.09998 6.53838L5.10178 10.1682L4.0435 15.4062L8.79708 12.7957L13.5565 15.4062L12.4982 10.1682L16.5 6.53838Z" />
        </svg>

      {%- else -%}
        <!-- empty outline star -->
        <svg
          class="empty_star"
          viewBox="0 0 17 17"
          xmlns="http://www.w3.org/2000/svg"
          role="img">
          <path
            fill="transparent"
            stroke="rgb(var(--color-primary))"
            stroke-width="1"
            vector-effect="non-scaling-stroke"
            d="M16.5 6.53838L11.0814 5.90982L8.79708 1.0625L6.51282 5.90982L1.09998 6.53838L5.10178 10.1682L4.0435 15.4062L8.79708 12.7957L13.5565 15.4062L12.4982 10.1682L16.5 6.53838Z" />
        </svg>
      {%- endif -%}
    </span>

  {%- endfor -%}
</div>